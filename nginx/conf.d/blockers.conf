# Block common attack patterns
map $request_uri $is_attack {
    default 0;
    ~*\.\./\.\./\.\./\.\./\.\./\.\./\.\./\.\./\.\./\.\. 1;  # Path traversal
    ~*/cgi-bin/ 1;                                           # CGI attacks
    ~*/\.git/ 1;                                             # Git exposure
    ~*/\.env 1;                                              # Env file access
    ~*/wp-admin/ 1;                                          # WordPress attacks
    ~*/wp-login 1;                                           # WordPress attacks
    ~*/phpmyadmin/ 1;                                        # phpMyAdmin attacks
    ~*/admin/ 1;                                             # Generic admin attacks
    ~*/shell 1;                                              # Shell access attempts
    ~*/cmd 1;                                                # Command execution
}

# Block suspicious user agents
map $http_user_agent $blocked_agent {
    default 0;
    ~*sqlmap 1;
    ~*nikto 1;
    ~*nmap 1;
    ~*masscan 1;
    ~*zgrab 1;
    ~*python-requests 1;  # Often used by bots
    ~*curl 1;             # Often used by bots (be careful with legitimate usage)
    "" 1;                 # Empty user agent
}